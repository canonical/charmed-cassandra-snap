#!/bin/sh -e

. "${SNAP}"/opt/cassandra/bin/cassandra-utils.sh

CONFIG_FILE="${CASSANDRA_CONF}/cassandra-env.sh"

handle_mem_config()
{
	max_heap_size="$(max_heap_size_mb)"
	heap_new_size="$(heap_new_size_mb)"

        if ! echo "$max_heap_size" | grep -Eq '^[0-9]+$'; then
            max_heap_size=""
        fi
    
        if ! echo "$heap_new_size" | grep -Eq '^[0-9]+$'; then
            heap_new_size=""
        fi
	
        # Экспортируем в окружение
        if [ -n "$max_heap_size" ]; then
            export MAX_HEAP_SIZE="${max_heap_size}M"
        else
            unset MAX_HEAP_SIZE
        fi
    
        if [ -n "$heap_new_size" ]; then
            export HEAP_NEWSIZE="${heap_new_size}M"
        else
            unset HEAP_NEWSIZE
        fi
	return 0
}

handle_mem_config
