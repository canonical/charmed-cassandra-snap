# Output all metric names in lowercase for Prometheus compatibility
lowercaseOutputName: true

# Output all label names in lowercase as well
lowercaseOutputLabelNames: true

# Define which JMX MBeans are allowed (whitelisted) for export as metrics
whitelistObjectNames: [
  # Table-level metrics
  "org.apache.cassandra.metrics:type=Table,name=WriteLatency,*",
  "org.apache.cassandra.metrics:type=Table,name=ReadLatency,*",

  # CQL query execution metrics
  "org.apache.cassandra.metrics:type=CQL,name=RegularStatementsExecuted,*",
  "org.apache.cassandra.metrics:type=CQL,name=PreparedStatementsExecuted,*",

  # Compaction metrics
  "org.apache.cassandra.metrics:type=Compaction,name=PendingTasks,*",
  "org.apache.cassandra.metrics:type=Compaction,name=CompletedTasks,*",
  "org.apache.cassandra.metrics:type=Compaction,name=BytesCompacted,*",
  "org.apache.cassandra.metrics:type=Compaction,name=TotalCompactionsCompleted,*",

  # Client request-level metrics
  "org.apache.cassandra.metrics:type=ClientRequest,name=Latency,*",
  "org.apache.cassandra.metrics:type=ClientRequest,name=Unavailables,*",
  "org.apache.cassandra.metrics:type=ClientRequest,name=Timeouts,*",

  # Storage metrics
  "org.apache.cassandra.metrics:type=Storage,name=Exceptions,*",
  "org.apache.cassandra.metrics:type=Storage,name=TotalHints,*",
  "org.apache.cassandra.metrics:type=Storage,name=TotalHintsInProgress,*",
  "org.apache.cassandra.metrics:type=Storage,name=Load,*",

  # Connection metrics
  "org.apache.cassandra.metrics:type=Connection,name=TotalTimeouts,*",

  # Thread pool activity
  "org.apache.cassandra.metrics:type=ThreadPools,name=CompletedTasks,*",
  "org.apache.cassandra.metrics:type=ThreadPools,name=PendingTasks,*",
  "org.apache.cassandra.metrics:type=ThreadPools,name=ActiveTasks,*",
  "org.apache.cassandra.metrics:type=ThreadPools,name=TotalBlockedTasks,*",
  "org.apache.cassandra.metrics:type=ThreadPools,name=CurrentlyBlockedTasks,*",

  # Dropped message metrics
  "org.apache.cassandra.metrics:type=DroppedMessage,name=Dropped,*",

  # Key cache performance
  "org.apache.cassandra.metrics:type=Cache,scope=KeyCache,name=HitRate,*",
  "org.apache.cassandra.metrics:type=Cache,scope=KeyCache,name=Hits,*",
  "org.apache.cassandra.metrics:type=Cache,scope=KeyCache,name=Requests,*",
  "org.apache.cassandra.metrics:type=Cache,scope=KeyCache,name=Entries,*",
  "org.apache.cassandra.metrics:type=Cache,scope=KeyCache,name=Size,*",

  # Streaming metrics
  "org.apache.cassandra.metrics:type=Streaming,name=TotalIncomingBytes,*",
  "org.apache.cassandra.metrics:type=Streaming,name=TotalOutgoingBytes,*",

  # Connected clients
  "org.apache.cassandra.metrics:type=Client,name=connectedNativeClients,*",
  "org.apache.cassandra.metrics:type=Client,name=connectedThriftClients,*",

  # Failure detector metrics
  "org.apache.cassandra.net:type=FailureDetector,*"
]

# === Metric transformation rules ===
rules:
  # Table-level metrics (highest priority - most specific pattern)
  - pattern: org.apache.cassandra.metrics<type=Table, keyspace=(\S*), scope=(\S*), name=(\S*)><>(Count|Mean|95thPercentile)
    name: cassandra_table_$3_$4
    labels:
      keyspace: "$1"
      table: "$2"

  # Client request metrics (specific for ClientRequest type)
  - pattern: org.apache.cassandra.metrics<type=ClientRequest, scope=(\S*), name=(\S*)><>(Count|Mean|95thPercentile)
    name: cassandra_clientrequest_$2_$3
    labels:
      request_type: "$1"

  # Cache metrics (specific for Cache type)
  - pattern: org.apache.cassandra.metrics<type=Cache, scope=(\S*), name=(\S*)><>(Count|Value|Mean)
    name: cassandra_cache_$2_$3
    labels:
      cache_type: "$1"

  # ThreadPools metrics (specific for ThreadPools type)
  - pattern: org.apache.cassandra.metrics<type=ThreadPools, path=(\S*), scope=(\S*), name=(\S*)><>(Count|Value)
    name: cassandra_threadpool_$3_$4
    labels:
      thread_pool: "$2"
      path: "$1"

  # ThreadPools metrics without path
  - pattern: org.apache.cassandra.metrics<type=ThreadPools, scope=(\S*), name=(\S*)><>(Count|Value)
    name: cassandra_threadpool_$2_$3
    labels:
      thread_pool: "$1"

  # DroppedMessage metrics
  - pattern: org.apache.cassandra.metrics<type=DroppedMessage, scope=(\S*), name=(\S*)><>(Count|Value)
    name: cassandra_droppedmessage_$2_$3
    labels:
      message_type: "$1"

  # Connection/Streaming metrics with scope (address)
  - pattern: org.apache.cassandra.metrics<type=(Connection|Streaming), scope=(\S*), name=(\S*)><>(Count|Value)
    name: cassandra_$1_$3_$4
    labels:
      address: "$2"

  # Compaction metrics (simple type without scope)
  - pattern: org.apache.cassandra.metrics<type=Compaction, name=(\S*)><>(Count|Value)
    name: cassandra_compaction_$1_$2

  # Storage metrics (simple type without scope)
  - pattern: org.apache.cassandra.metrics<type=Storage, name=(\S*)><>(Count|Value)
    name: cassandra_storage_$1_$2

  # CQL metrics (simple type without scope)
  - pattern: org.apache.cassandra.metrics<type=CQL, name=(\S*)><>(Count|Value)
    name: cassandra_cql_$1_$2

  # Client metrics (simple type without scope)
  - pattern: org.apache.cassandra.metrics<type=Client, name=(\S*)><>(Count|Value)
    name: cassandra_client_$1_$2

  # Keyspace-level metrics (if any exist)
  - pattern: org.apache.cassandra.metrics<type=Keyspace, keyspace=(\S*), name=(\S*)><>(Count|Mean|95thPercentile)
    name: cassandra_keyspace_$2_$3
    labels:
      keyspace: "$1"

  # Failure detector metrics (different package)
  - pattern: org.apache.cassandra.net<type=FailureDetector><>(DownEndpointCount)
    name: cassandra_failuredetector_$1

  # Catch-all rule for any remaining metrics (lowest priority)
  - pattern: org.apache.cassandra.metrics<type=(\S*), name=(\S*)><>(Count|Value)
    name: cassandra_$1_$2_$3