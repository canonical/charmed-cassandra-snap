lowercaseOutputLabelNames: true
lowercaseOutputName: true

# Cassandra has a lot of metrics, and some of them are quite slow to query.
# Fetching all available metrics causes a lot of Cassandra CPU usage and will
# likely exceed your scrape timeout, so it's recommended to use a whitelist
# approach. An example whitelist is provided here.
#
# You can run `jmxtool dump` on a Cassandra node to list all available metrics,
# and there is some documentation available here:
# https://cassandra.apache.org/doc/5.0/cassandra/managing/operating/metrics.html
whitelistObjectNames:
  - "org.apache.cassandra.metrics:type=Client,*"
  - "org.apache.cassandra.metrics:type=Compaction,*"
  - "org.apache.cassandra.metrics:type=Connection,name=Timeouts,*"
  - "org.apache.cassandra.metrics:type=DroppedMessage,name=Dropped,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=AllMemtablesLiveDataSize,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=AllMemtablesOffHeapDataSize,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=AllMemtablesOnHeapDataSize,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=AntiCompactionTime,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=BloomFilterFalsePositives,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=BloomFilterFalseRatio,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=BytesValidated,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=ReadLatency,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=ReadTotalLatency,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=RepairedDataInconsistenciesConfirmed,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=RepairJobsCompleted,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=RepairJobsStarted,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=RepairTime,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=WriteLatency,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=WriteTotalLatency,*"
  - "org.apache.cassandra.metrics:type=Keyspace,name=PendingCompactions,*"
  - "org.apache.cassandra.metrics:type=ReadRepair,*"
  - "org.apache.cassandra.metrics:type=Storage,name=Exceptions,*"
  - "org.apache.cassandra.metrics:type=Storage,name=Load,*"
  - "org.apache.cassandra.metrics:type=Storage,name=RepairExceptions,*"
  - "org.apache.cassandra.metrics:type=Storage,name=TotalHints,*"
  - "org.apache.cassandra.metrics:type=ThreadPools,*"
  - "org.apache.cassandra.metrics:type=ColumnFamily,*,name=LiveSSTableCount"
  - "org.apache.cassandra.metrics:type=ColumnFamily,*,name=BytesUnrepaired"
  
rules:
  # Prometheus: cassandra_client_value{name="connectedNativeClients"}
  # Prometheus: cassandra_cache_value{scope="KeyCache", name="Size"}
  - pattern: org.apache.cassandra.metrics<type=(\S*)(?:, scope=(\S*))?(?:, name=(\S*))?><>Value
    name: cassandra_$1_value
    type: GAUGE
    labels:
      scope: "$2" # $2 захватывает scope, если присутствует
      name: "$3"  # $3 захватывает name, если присутствует

  # Prometheus: cassandra_cache_count{scope="KeyCache", name="Requests"}
  - pattern: org.apache.cassandra.metrics<type=(\S*)(?:, scope=(\S*))?(?:, name=(\S*))?><>Count
    name: cassandra_$1_count
    type: COUNTER
    labels:
      scope: "$2"
      name: "$3"

  # Prometheus: cassandra_cache_fifteen_minute_rate{scope="KeyCache", name="Requests"}
  - pattern: org.apache.cassandra.metrics<type=(\S*)(?:, scope=(\S*))?(?:, name=(\S*))?><>(FifteenMinuteRate|FiveMinuteRate|MeanRate|OneMinuteRate)
    name: cassandra_$1_$4
    type: GAUGE
    labels:
      scope: "$2"
      name: "$3"

  # Prometheus: cassandra_keyspace_total_latency_seconds_sum{name="ReadTotalLatency"}
  - pattern: org.apache.cassandra.metrics<type=(\S*)(?:, scope=(\S*))?(?:, name=(.+))?><>TotalLatency><>Count
    name: cassandra_$1_total_latency_seconds_sum
    type: UNTYPED
    labels:
      scope: "$2"
      name: "$3"
    valueFactor: 0.000001

  # Prometheus: cassandra_keyspace_latency_seconds_count{name="ReadLatency"}
  - pattern: org.apache.cassandra.metrics<type=(\S*)(?:, scope=(\S*))?(?:, name=(.+))?><>Latency><>Count
    name: cassandra_$1_latency_seconds_count
    type: UNTYPED
    labels:
      scope: "$2"
      name: "$3"

  # Prometheus: cassandra_keyspace_latency_seconds{name="ReadLatency", quantile="0.99"}
  - pattern: org.apache.cassandra.metrics<type=(\S*)(?:, scope=(\S*))?(?:, name=(.+))?><>Latency><>(\d+)thPercentile
    name: cassandra_$1_latency_seconds
    type: GAUGE
    labels:
      scope: "$2"
      name: "$3"
      quantile: "0.$4"
    valueFactor: 0.000001

  # Prometheus: cassandra_somemetric_percentile{name="AnotherName", quantile="0.50"}
  - pattern: org.apache.cassandra.metrics<type=(\S*)(?:, scope=(\S*))?(?:, name=(.+))?><>(\d+)thPercentile
    name: cassandra_$1_percentile
    type: GAUGE
    labels:
      scope: "$2"
      name: "$3"
      quantile: "0.$4"